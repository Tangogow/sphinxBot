# Sphinx Campus Auto-fill Fake Survey Bot

Simple survey auto-filling bot for [SphinxCampus](https://sphinx-campus.com/).

Sphinx allows **multiple IP surveys**. May not be the case in the future.

## Table of content

1. [Description](#description)
2. [Dependencies](#dependencies)
3. [Getting started](#getting-started)
4. [Example](#example)
5. [Inputs types](#inputs-types)
6. [Troubleshooting](#troubleshooting)
7. [Code explanation](#code-explanation)
8. [Todo](#todo)

## Description

You have to set the URL of your Sphinx survey, then add manually all the field and the scripts gonna get a random value in between the provided interval. For random word field questions, you'll have to create a list with all the wanted words. (random names, email, answers etc)

The survey contains a form which is composed by "*controls*", typically a question. The control is a composed by one or multiple input HTML tags.

Since every control got a random ID generated by Sphinx at the survey creation, you'll need to get them individually.
Simply do a right click on the question on the survey page, then **Inspect Element** (whatever the web browser you're using).
You'll see a high number between 8 and 10 digits very recurring in the current section of the code. That's the control ID.

Repeat the right click operation for each question.

## Dependencies

- [Mechanize](https://pypi.org/project/mechanize/) 0.4.5

```bash
pip install mechanize
```

Tested in python 2.7 and 3.6.

## Getting started

1. Fill up the config file `config.py` with your parameters: URL, numbers of surveys, number of time needed by each and time between each survey filling.

2. 

```bash
python sphinxBot.py
# OR
chmod +x sphinxBot.py && ./sphinxBot.py
```

## Example

Have a look in `sphinxBot.py`.

## Inputs types

```python
checkbox(max=2, mandatory=True, multiple=False, minAnwsers=0, maxAnswers=0)
postit(max=2, mandatory=True, multiple=False, minAnwsers=0, maxAnswers=0)
smiley(max=2, mandatory=True)
images(max=2, mandatory=True, multiple=False, minAnwsers=0, maxAnswers=0)
dropdown(max=2, mandatory=True)
graduated(max=2, mandatory=True)
stars(max=2, mandatory=True)
ranking(max=2, mandatory=True, multiple=False, minAnwsers=0, maxAnswers=0)
imageRanking(max=2, mandatory=True, multiple=False, minAnwsers=0, maxAnswers=0)
dragAndDrop(max=2, mandatory=True, multiple=False, minAnwsers=0, maxAnswers=0)
imageDragAndDrop(max=2, mandatory=True, multiple=False, minAnwsers=0, maxAnswers=0)
number(min=0, max=1, positive=True, negative=False)
text(min=1, max=2, textlist=None)
email(min=1, max=2, emailList=None)
code(min=1, max=2, codeList=None)
draggable(min=1, max=2, nbchoice=None)
```
##### Conditional question
If a controls depend on another like a question, ie:

"*Do you have a favorite pokemon*" ?
  - Yes
  - No

"*If yes then what's it's name ?*"

You'll need to pass a condition as following:

```python
form['<parent id>'] = checkbox(2)
if form['<parent id>'] == ['1']:
  form['<child id>'] = text(1, 1, pokemon)
```

Assuming your questions settings are configured as your **Yes** stands in first position. (therefore the `['1']`)

## Troubleshooting

If you messed up a control, it will send you as response the survey page with the error at the top.

Simply do a `python sphinxBot.py > test.html` and open `test.html` in a browser to see the error.

If anything is okay, it will send you the **Thanks message**, and your survey will be inserted in the sphinx database.

**Before disabling degug in the test phase, check the values if you have access to the survey results to be sure the script fills correctly the inputs fields**

#### Errors

`No control matching name '...'`

You either entered the wrong URL or wrong control ID.
Enable the `debugHTML` varialbe to see what's going on.

## Code explanation

#### Input response

The inputs response for HTMLForm object needs :
  * String
  * List with only one entry
  * List with multiple entry

You can also provide non mandatory controls, empty string, or empty lists, but more simply, you don't need to send them in the request if they're not necessary to the survey form.

For some shady reason, some input needs a list with only one entry to work (like numbers)
Every response (even integers) needs to be stringified.

List are converted in string with comas in the POST request.

#### Redirection

When you open a link of a survey named "Pokemon", ie: https://sphinx-campus.com/d/s/11aaaa

will redirect you on https://sphinx-campus.com/SurveyServer/s/your_account_name/Pokemon

It you directly open the redirection link, it will tell the page is broken. That's because of the odd behaviour of the sphinx website.

When you load the link page [GET], it will return you 2 html pages, one called 11aaaa, the other one Pokemon.

It will give you 3 cookies: `__AntiXsrfToken` (basically a CSRF token), `ShakerSession` and `Lang`

That's why you need 2 requests to get to the survey page. Otherwise, if you miss the tokens exchange, you're going to be blocked.

## Todo

- [ ] IP switching
- [ ] Influenced probability (so not so fully random)
- [x] Fake user-agent for smartphone/tablet origin
- [ ] Text & number mandatory
- [ ] Fake origin link (Direct/facebook)
